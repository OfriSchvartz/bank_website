<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Login</title>
    <link rel="stylesheet" href="../static/styles.css">
    <script>
      function validateLogin()
      {
      const id = document.getElementById("id").value;
      const password = document.getElementById("password").value;
      if(id == "")
        {
        alert("Please enter bank id");
        return false;
        }
        else if(id.length < 5)
        {
        alert("Bank ID must be at least 5 characters long");
        return false;
        }
                
        if(password == "")
        {
        alert("Please enter password");
        return false;
        }
        else if(password.length < 8)
        {
        alert("Password must be at least 8 characters long");
        return false;
        }

        isUpper = false;
        isLower = false;
        isDigit = false;
        isSpecial = false;

        for(let i=0; i<password.length; i++) {
          if(password[i] >= 'A' && password[i] <= 'Z') {
            isUpper = true;
          } 
          else if(password[i] >= 'a' && password[i] <= 'z') {
            isLower = true;
          } 
          else if(password[i] >= '0' && password[i] <= '9') {
            isDigit = true;
          } 
          else {
            isSpecial = true;
          }
        }
          if (isUpper == false || isLower == false || isDigit == false || isSpecial == false) {
            alert("Password must contain at least one uppercase letter, one lowercase letter, one digit, and one special character.");
            return false;
          }

        localStorage.setItem("account_number", id);
        return true;
      }
      async function checkLoginInfo()
      {
        const id = document.getElementById("id").value;
        const password = document.getElementById("password").value;
        return fetch("http://127.0.0.1:5000/api/login", 
          {
            method: "POST",
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              "id": id,
              "password": password
            })
          }
        ).then(res => res.json()).then(data => {
          if (data.status == false) {
            alert(data.text);
            return false; 
          } 
          else 
          {
            return true; 
          }
        })
      }

      async function submitLogin() 
      {
        
        result = validateLogin();
        if (result == false) {
          return false;
        }
        result = await checkLoginInfo();
        if (result == false) {
          return false;
        }
        else {
          alert("Login successful");  
          window.location.href = "/page/account";
        }
    }
    </script>
</head>
<body>
  <form id="loginForm" class="form" novalidate autocomplete="off">
    <h1 class="form-title">Login</h1>
      <div class="login-container">
        <img class="logo" src="../images/bank.jpg" alt="Bank Logo" title="Bank Logo" id="logo">
      </div>

    <div class="form-row">
      <label for="id" class="required">ID Number</label>
      <input
        id="id" name="id" type="text" placeholder="Enter your ID number"  title="Fill out this field.">
    </div>

    <div class="form-row">
      <label for="password" class="required">Password</label>
      <input
        id="password" name="password" type="password" placeholder="Enter your password" title="Fill out this field.">
    </div>

    <div class="form-row form-checkbox">
        <input id="rememberMe" name="rememberMe" type="checkbox">
        <label for="rememberMe">Remember Me</label>
    </div>

    <button type="button" onclick="submitLogin()" class="btn-primary">Login</button>
    
    <p class="form-footer">
      Donâ€™t have an account? <a href="/page/register">Register here</a><br>
      Forgot your password? <a href="/page/recover">Reset Password</a>
    </p>
  </form>

  
</body>
</html>
